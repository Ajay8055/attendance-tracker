<!DOCTYPE html>
<html>
<head>
  <title>Attendance & Labour Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 8px; }
    th { background: #f2f2f2; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h2>Attendance & Labour Charge Tracker</h2>

  <label for="date">Select Date:</label>
  <input type="date" id="date" value="">
  <br><br>

  <label for="wage">Daily Wage (₹):</label>
  <input type="number" id="wage" value="500">
  <br><br>

  <input type="text" id="studentName" placeholder="Enter name">
  <button onclick="addStudent()">Add Worker</button>

  <h3>Mark Attendance</h3>
  <div id="studentList"></div>

  <h3>Attendance Log</h3>
  <table id="attendanceTable">
    <tr>
      <th>Date</th>
      <th>Name</th>
      <th>Status</th>
      <th>Charge (₹)</th>
    </tr>
  </table>

  <br>
  <button onclick="downloadCSV()">Download CSV</button>

  <script>
    // Default today's date
    document.getElementById("date").value = new Date().toISOString().split("T")[0];

    // Load attendance log from localStorage
    let attendanceData = JSON.parse(localStorage.getItem("attendance")) || [];

    // Display saved data
    function loadAttendance() {
      let table = document.getElementById("attendanceTable");
      // Reset table with header
      table.innerHTML = `
        <tr>
          <th>Date</th>
          <th>Name</th>
          <th>Status</th>
          <th>Charge (₹)</th>
        </tr>
      `;
      attendanceData.forEach(entry => {
        let row = table.insertRow();
        row.insertCell(0).innerHTML = entry.date;
        row.insertCell(1).innerHTML = entry.name;
        row.insertCell(2).innerHTML = entry.status;
        row.insertCell(3).innerHTML = entry.charge;
      });
    }

    function addStudent() {
      let name = document.getElementById("studentName").value.trim();
      if (name === "") return;

      let list = document.getElementById("studentList");
      let div = document.createElement("div");
      div.innerHTML = `
        ${name} 
        <button onclick="markAttendance('${name}', 'Present')">Present</button>
        <button onclick="markAttendance('${name}', 'Absent')">Absent</button>
      `;
      list.appendChild(div);
      document.getElementById("studentName").value = "";
    }

    function markAttendance(name, status) {
      let date = document.getElementById("date").value;
      let wage = parseFloat(document.getElementById("wage").value) || 0;
      let charge = (status === "Present") ? wage : 0;

      let entry = { date: date, name: name, status: status, charge: charge };

      attendanceData.push(entry);
      localStorage.setItem("attendance", JSON.stringify(attendanceData));

      loadAttendance();
    }

    // Download as CSV
    function downloadCSV() {
      let csv = "Date,Name,Status,Charge (₹)\n";
      attendanceData.forEach(entry => {
        csv += `${entry.date},${entry.name},${entry.status},${entry.charge}\n`;
      });

      let blob = new Blob([csv], { type: "text/csv" });
      let url = window.URL.createObjectURL(blob);

      let a = document.createElement("a");
      a.setAttribute("hidden", "");
      a.setAttribute("href", url);
      a.setAttribute("download", "attendance.csv");
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // Initial load
    loadAttendance();
  </script>
</body>
</html>